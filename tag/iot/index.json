[
  {
    "title": "I Made a WiFi Pumpkin",
    "tags": [
      "diy",
      "hardware",
      "halloween",
      "esp8266",
      "iot"
    ],
    "year": "2018",
    "month": "02",
    "day": "08",
    "isDir": true,
    "slug": "pumpkin",
    "date": "2018-02-08T12:00:00.000Z",
    "postName": "2018-02-08-pumpkin",
    "html": "<p><strong>TL;DR</strong>: I made a wifi pumpkin using an ESP8266 with LED matrix eyes and mouth.\nI added a web-based remote control for my phone using websockets. It was fun!</p>\n<!--more-->\n\n<nav role=\"navigation\" class=\"table-of-contents\"></nav>\n\n<p>A few years ago, <a href=\"https://twitter.com/lmorchard/status/651958618800177152\">I decided</a> to use some LED matrices to make animated\neyes for a jack-o&#39;-lantern. Not terribly original, but it sounded fun.</p>\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">Considering getting some LED matrices to make animated eyes &amp; mouth for a jack-o-lantern. Seems like it could be a fun project or a disaster</p>&mdash; Les Orchard (@lmorchard) <a href=\"https://twitter.com/lmorchard/status/651958618800177152?ref_src=twsrc%5Etfw\">October 8, 2015</a></blockquote>\n\n<h2 id=\"v10-2015\">v1.0 (2015)</h2>\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/21954391310/in/datetaken/\" title=\"LED matrix on a Raspberry PI\"><img class=\"inset wide left\" src=\"raspi.jpg\" alt=\"LED matrix on a Raspberry PI\"></a></p>\n<p>My first thought was to use a Raspberry Pi.  It was easy to get an LED matrix\nworking in Python. And, I had a notion to build some kind of remote control\nover wifi. But, it felt like overkill to stuff a whole Linux computer\ninto a gourd. (<a href=\"http://strangehorizons.com/non-fiction/articles/installing-linux-on-a-dead-badger-users-notes/\">A dead badger might work</a>, but this was not that kind\nof project.)</p>\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/21994112010/in/datetaken/\" title=\"LED eyes for Pumpkin\"><img class=\"inset wide left\" src=\"arduino.jpg\" alt=\"LED eyes for Pumpkin\"></a></p>\n<p>That&#39;s when I remembered the Arduino Uno I had stashed in a drawer.  I found\n<a href=\"https://mjanyst.weebly.com/arduino-pumpkin-eyes.html\">this guy&#39;s project</a>, which confirmed I wasn&#39;t the first to try\nthis. But it was nice to start from <a href=\"https://github.com/michaltj/LedEyes/blob/master/LedEyes.ino\">someone else&#39;s code</a>. </p>\n<p>I had a brief go at scripting some animations, which resulted\nin an <a href=\"https://github.com/lmorchard/arduino-sketches/blob/master/googly_eyes/googly_eyes.ino\">over-engineered little sketch</a> that helped me \nexercise my rusty C skills.</p>\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/22453913015/in/datetaken/\" title=\"NES pad eyes for Pumpkin\"><img class=\"inset wide left\" src=\"nespad1.jpg\" alt=\"NES pad eyes for Pumpkin\"></a></p>\n<p>From there, I discovered an <a href=\"https://github.com/joshmarinacci/nespad-arduino\">NESPad library</a> that made <a href=\"https://github.com/lmorchard/arduino-sketches/blob/master/nespad_eyes/nespad_eyes.ino\">hooking up a\ncontroller</a> simple. It&#39;s just <a href=\"https://www.allaboutcircuits.com/projects/nes-controller-interface-with-an-arduino-uno/\">a serial interface\npowered by a shift register</a> - pre-teen me would have been impressed that I\nfinally learned how so many buttons worked with so few pins.</p>\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/22463866250/in/datetaken/\" title=\"Pumpkin, candy, NES pad\"><img class=\"inset wide left\" src=\"orig-real-pumpkin-3.jpg\" /></a></p>\n<p>When Halloween arrived, I hustled to get it done before dusk: I carved some\nquick square holes for eyes, nose, and mouth - let&#39;s say it&#39;s an 8-bit thing. </p>\n<p>I bundled up the electronics with plastic wrap and crammed the mess into\nthe pumpkin. I strapped the LED matrices in with picture\nwire. The results weren&#39;t too bad in the dark. \nTrick-or-treaters seemed entertained by my cyborg pumpkin buddy as I handed out\ncandy!</p>\n<p>Not long after Halloween, the gourd went downhill fast. Pumpkins are\nnot a good choice of long-term project enclosure. I put it off as long as I could, but\nfinally I had to put on some gloves to rescue my parts from the slimy\nmess. Those parts went in a box and went untouched for the next year. \n<br style=\"clear:both\"></p>\n<h2 id=\"v20-2016\">v2.0 (2016)</h2>\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/30331621951/in/datetaken/\" title=\"Pumpkin 2.0\"><img class=\"inset wide right\" src=\"pumpkin2-1.jpg\" /></a></p>\n<p>As Halloween approached again, I wanted to give the project another go. I\nfound a foam pumpkin at Target that seemed realistic. A little time at\n<a href=\"https://www.i3detroit.org/\">the local maker space</a> with my Swiss Army knife, and I had a freshly carved\nsynthetic jack-&#39;o-lantern. </p>\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/30380916606/in/datetaken/\" title=\"Pumpkin 2.0\"><img class=\"inset wide right\" src=\"pumpkin2-2.jpg\" /></a></p>\n<p>Rather than glue things together, I just used some gaffer tape inside to hold\nthe eyes in place. I&#39;d planned to add some more LED matrices to give it a mouth,\nbut never quite got around to it. The little guy seems a bit creepy with just a\npair of eyes, though.</p>\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/30380883136/in/datetaken/\" title=\"Pumpkin 2.0 NES connection\"><img class=\"inset wide right\" src=\"nes-connection.jpg\" alt=\"Pumpkin 2.0 NES connection\"></a></p>\n<p>With a house move in the works, my ambition ran out fast that year. I\ndidn&#39;t make any code changes, but I did have to do some reverse engineering.</p>\n<p>Because, of course, I hadn&#39;t left myself good notes and some of the wires had\ncome undone over the past year.  My poor NES controller was looking sad with\nwires just kind of crammed into it.  But, it still worked.</p>\n<p>I refreshed the thing just enough to make it live to see another day. We\ndidn&#39;t hand out candy that year, though, so the thing just decorated my office\nfor awhile. <br style=\"clear:both\"></p>\n<h2 id=\"v30-2017\">v3.0 (2017)</h2>\n<!--\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37852469272/in/datetaken/\" title=\"Pumpkin meets hot glue\"><img class=\"inset wide right\" src=\"hot-glue.jpg\" alt=\"Pumpkin meets hot glue\"></a>\n-->\n\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/24031281868/in/datetaken/\" title=\"20171022_203806\"><img id=\"thumbnail\" class=\"inset wide left\" src=\"pumpkin.jpg\" alt=\"20171022_203806\"></a></p>\n<p>Another Halloween and I felt an urge to get more ambitious: I’d picked up that\nArduino at a Maker Faire back in 2011, pretty far from state of the art these \ndays. </p>\n<p>I’d been reading about the <a href=\"https://www.espressif.com/en/products/hardware/esp8266ex/overview\">ESP8266</a> -\na cheap and tiny WiFi module that had been repurposed for\nmore tinkery things.  In fact, I read that you could even flash unmodified\nArduino sketches onto the thing.</p>\n<!--\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/24031428708/in/datetaken/\" title=\"Creepy pumpkin eyes\"><img class=\"inset wide left\" src=\"creepy.jpg\" alt=\"Creepy pumpkin eyes\"></a>\n-->\n\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37626526390/in/datetaken/\" title=\"20171019_233614\"><img class=\"inset wide left\" src=\"interior.jpg\" alt=\"20171019_233614\"></a></p>\n<p>So, I ordered <a href=\"http://a.co/8zPcmQ5\">an ESP8266 dev board</a> and four more <a href=\"http://a.co/3Mc3qZZ\">8x8 LED\nmatrices</a> for a mouth.\nIt took me an hour to <a href=\"https://github.com/lmorchard/arduino-sketches/blob/master/nodemcu/nespad_eyes/nespad_eyes.ino\">port my old Arduino sketch over</a>,\nincluding the time to set up the dev stack. The eyes came alive on\nthe new hardware in very short order. Another hour and I had the\nmouth animating.</p>\n<!--\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37852235042/in/datetaken/\" title=\"20171017_005235\"><img class=\"inset wide left\" src=\"mouth.jpg\" alt=\"20171017_005235\"></a>\n-->\n\n<!--\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37173755914/in/datetaken/\" title=\"20171021_230802\"><img class=\"inset wide left\" src=\"missing-column.jpg\" alt=\"20171021_230802\"></a>\n-->\n\n<p>A bit more carving, and I was ready to install the mouth. I switched\nfrom gaffer tape to hot glue to make things more permanent. Alas, somehow I\ndamaged a column of LEDs in the process. But, oh well: I just gave it fangs.</p>\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37626516700/in/datetaken/\" title=\"20171019_233504\"><img class=\"inset wide left\" src=\"plugs.jpg\" alt=\"20171019_233504\"></a></p>\n<!--\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37626520570/in/datetaken/\" title=\"20171019_233530\"><img class=\"inset wide wide left\" src=\"plugged-in.jpg\" alt=\"20171019_233530\"></a>\n-->\n\n<p>To tidy the whole thing up, I bought extension cables for USB power and the NES\ngamepad. I hacked those up and hot glued them into the back of the pumpkin. </p>\n<p>When I was done, I had no cables trailing out from the inside of the thing. And, I could\nstop shoving bare wires into the end of an NES pad. And, if I wanted to go\ncompletely wireless, I could drop a USB power bank into the top and just\nconnect it from inside.\n<br style=\"clear:both\"></p>\n<h2 id=\"v40-2017\">v4.0 (2017)</h2>\n<p>But, speaking of completely wireless: Back at the start, I&#39;d\nconsidered using a Raspberry Pi.  Given a USB wifi adapter, I could have\nwritten a little web app to use as a remote control for the pumpkin. I still\nwanted to make that happen.</p>\n<p>I knew this ESP8266 thing was handy, but I didn&#39;t realize just how handy until I did some more research. I found an interesting set of libraries to glue together:</p>\n<ul>\n<li><a href=\"https://github.com/esp8266/Arduino\">ESP8266 Arduino core</a> - this let me port my sketch over mostly unmodified</li>\n<li><a href=\"http://esp8266.github.io/Arduino/versions/2.0.0/doc/filesystem.html\">SPIFFS</a> - offers an onboard filesystem in flash memory</li>\n<li><a href=\"https://github.com/esp8266/Arduino/tree/master/libraries/ESP8266WebServer\">ESP8266WebServer</a> - an embedded webserver that <a href=\"https://github.com/esp8266/Arduino/tree/master/libraries/ESP8266WebServer/examples/FSBrowser\">serves up static files from SPIFFS</a> and lets me handle some URL routes with C code</li>\n<li><a href=\"https://github.com/Links2004/arduinoWebSockets\">arduinoWebsockets</a> - websockets server and client libraries</li>\n<li><a href=\"https://github.com/tzapu/WiFiManager\">WiFiManager</a> - code to fire up an temporary Access Point with a captive web portal to bootstrap wifi configuration - great for a device with no screen or keyboard</li>\n</ul>\n<p>Long story short, I used all the above to produce this masterpiece:</p>\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/24031282388/in/datetaken/\" title=\"Screenshot_20171023-004211\"><img class=\"fullwidth\" src=\"controls.jpg\" alt=\"Screenshot_20171023-004211\"></a></p>\n<p>What you&#39;re looking at is the wifi remote control for my pumpkin. The big yellow square is a virtual touchpad - dragging my finger across it moves the eyeballs. Tapping &quot;Blink&quot; makes the eyes blink, while &quot;Talk&quot; makes the mouth open &amp; close.</p>\n<p>It&#39;s a little web page loaded up from the onboard file system. It connects back to a websocket server that <a href=\"https://github.com/lmorchard/arduino-sketches/blob/master/nodemcu/nespad_eyes/nespad_eyes.ino#L324\">accepts a bunch of little commands</a> - which, oddly enough, map directly to NES pad buttons so I could be lazy and just reuse all the same code paths.</p>\n<p>Building this went way easier than I expected. Sure, it&#39;s embarassing code that anyone sensible would shred in a code review. But, it was fun hacking and works pretty much like I hoped it would. In particular, I was surprised at how responsive it ended up being. Without any optimization, it follows my taps and drags without noticible lag.</p>\n<p>So, for another year, I sat next to an animated glowing pumpkin while I handed\nout candy. But this time, I played amateur ventriloquist and had the thing\ntalking to kids while I prodded at my cell phone. Pretty awkward and nerdy, but\nI think some folks appreciated it. They humored me, at least.</p>\n<h2 id=\"v50-whats-next\">v5.0? What&#39;s next?</h2>\n<p>A few months later, this project is lying fallow. It’s on display in my office, where I can watch the semi-random idle gibbering whenever I like. And though I haven&#39;t gotten back to any ESP8266 tinkering since October, I&#39;m still kind of musing over what I could hack together next.</p>\n<p><a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37885815451/in/datetaken/\" title=\"20171023_144656\"><img class=\"fullwidth\" src=\"in-office.jpg\" alt=\"20171023_144656\"></a></p>\n<p>It feels weird to say it, but this project might be done: this pumpkin seems pretty close to my original idea. </p>\n<p>I’ve mused about maybe building some sort of voice assistant into it: talk to the pumpkin, control things around the house, hear about the weather, order it to fire candy into kids’ bags with tiny trebuchets - who knows?</p>\n<p>I could upgrade from LED matrices to <a href=\"https://learn.adafruit.com/animated-electronic-eyes-using-teensy-3-1/overview\">full-blown OLED screens</a>. Though, if I did that, I&#39;ve got a notion to build myself a replica of 790 from Lexx. I&#39;d probably regret it, but he seems more my kind of personal assistant than current offerings like Alexa or Siri:</p>\n<div style=\"position: relative; padding-bottom: 56.25%;\">\n  <iframe class=\"lazyload\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%;\" src=\"\" data-src=\"https://www.youtube.com/embed/s8d1mfLa5Vk\" frameborder=\"0\" gesture=\"media\" allow=\"encrypted-media\" allowfullscreen></iframe>\n</div>\n\n<p>I&#39;ve also been thinking bigger: Like, what if I turned my <em>house</em> into an animated character? Combine some <a href=\"https://www.itead.cc/sonoff-wifi-wireless-switch.html\">ESP8266&#39;s with AC relays</a> and orchestrate strings of holiday lights into something animated? I could be <em>that</em> guy on the block!</p>\n<p>Anyway, let me know what you think!</p>\n<script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\n<!-- vim: set wrap linebreak nolist wrapmargin=0 textwidth=0 syntax=markdown formatoptions-=t: -->\n",
    "body": "**TL;DR**: I made a wifi pumpkin using an ESP8266 with LED matrix eyes and mouth.\nI added a web-based remote control for my phone using websockets. It was fun!\n\n<!--more-->\n\n<nav role=\"navigation\" class=\"table-of-contents\"></nav>\n\nA few years ago, [I decided][pumpkintweet] to use some LED matrices to make animated\neyes for a jack-o'-lantern. Not terribly original, but it sounded fun.\n\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"en\" dir=\"ltr\">Considering getting some LED matrices to make animated eyes &amp; mouth for a jack-o-lantern. Seems like it could be a fun project or a disaster</p>&mdash; Les Orchard (@lmorchard) <a href=\"https://twitter.com/lmorchard/status/651958618800177152?ref_src=twsrc%5Etfw\">October 8, 2015</a></blockquote>\n\n[pumpkintweet]: https://twitter.com/lmorchard/status/651958618800177152\n\n## v1.0 (2015)\n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/21954391310/in/datetaken/\" title=\"LED matrix on a Raspberry PI\"><img class=\"inset wide left\" src=\"raspi.jpg\" alt=\"LED matrix on a Raspberry PI\"></a>\n\nMy first thought was to use a Raspberry Pi.  It was easy to get an LED matrix\nworking in Python. And, I had a notion to build some kind of remote control\nover wifi. But, it felt like overkill to stuff a whole Linux computer\ninto a gourd. ([A dead badger might work][badger], but this was not that kind\nof project.)\n\n[badger]: http://strangehorizons.com/non-fiction/articles/installing-linux-on-a-dead-badger-users-notes/\n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/21994112010/in/datetaken/\" title=\"LED eyes for Pumpkin\"><img class=\"inset wide left\" src=\"arduino.jpg\" alt=\"LED eyes for Pumpkin\"></a>\n\nThat's when I remembered the Arduino Uno I had stashed in a drawer.  I found\n[this guy's project][otherpump], which confirmed I wasn't the first to try\nthis. But it was nice to start from [someone else's code][workingcode]. \n\n[workingcode]: https://github.com/michaltj/LedEyes/blob/master/LedEyes.ino\n[otherpump]:  https://mjanyst.weebly.com/arduino-pumpkin-eyes.html\n\nI had a brief go at scripting some animations, which resulted\nin an [over-engineered little sketch][overengineered] that helped me \nexercise my rusty C skills.\n\n[overengineered]: https://github.com/lmorchard/arduino-sketches/blob/master/googly_eyes/googly_eyes.ino\n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/22453913015/in/datetaken/\" title=\"NES pad eyes for Pumpkin\"><img class=\"inset wide left\" src=\"nespad1.jpg\" alt=\"NES pad eyes for Pumpkin\"></a>\n\nFrom there, I discovered an [NESPad library][] that made [hooking up a\ncontroller][hookingup] simple. It's just [a serial interface\npowered by a shift register][neshow] - pre-teen me would have been impressed that I\nfinally learned how so many buttons worked with so few pins.\n\n[neshow]: https://www.allaboutcircuits.com/projects/nes-controller-interface-with-an-arduino-uno/\n[hookingup]: https://github.com/lmorchard/arduino-sketches/blob/master/nespad_eyes/nespad_eyes.ino\n[nespad library]: https://github.com/joshmarinacci/nespad-arduino \n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/22463866250/in/datetaken/\" title=\"Pumpkin, candy, NES pad\"><img class=\"inset wide left\" src=\"orig-real-pumpkin-3.jpg\" /></a>\n\nWhen Halloween arrived, I hustled to get it done before dusk: I carved some\nquick square holes for eyes, nose, and mouth - let's say it's an 8-bit thing. \n\nI bundled up the electronics with plastic wrap and crammed the mess into\nthe pumpkin. I strapped the LED matrices in with picture\nwire. The results weren't too bad in the dark. \nTrick-or-treaters seemed entertained by my cyborg pumpkin buddy as I handed out\ncandy!\n\nNot long after Halloween, the gourd went downhill fast. Pumpkins are\nnot a good choice of long-term project enclosure. I put it off as long as I could, but\nfinally I had to put on some gloves to rescue my parts from the slimy\nmess. Those parts went in a box and went untouched for the next year. \n<br style=\"clear:both\">\n\n## v2.0 (2016)\n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/30331621951/in/datetaken/\" title=\"Pumpkin 2.0\"><img class=\"inset wide right\" src=\"pumpkin2-1.jpg\" /></a>\n\nAs Halloween approached again, I wanted to give the project another go. I\nfound a foam pumpkin at Target that seemed realistic. A little time at\n[the local maker space][i3] with my Swiss Army knife, and I had a freshly carved\nsynthetic jack-'o-lantern. \n\n[i3]: https://www.i3detroit.org/\n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/30380916606/in/datetaken/\" title=\"Pumpkin 2.0\"><img class=\"inset wide right\" src=\"pumpkin2-2.jpg\" /></a>\n\nRather than glue things together, I just used some gaffer tape inside to hold\nthe eyes in place. I'd planned to add some more LED matrices to give it a mouth,\nbut never quite got around to it. The little guy seems a bit creepy with just a\npair of eyes, though.\n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/30380883136/in/datetaken/\" title=\"Pumpkin 2.0 NES connection\"><img class=\"inset wide right\" src=\"nes-connection.jpg\" alt=\"Pumpkin 2.0 NES connection\"></a>\n\nWith a house move in the works, my ambition ran out fast that year. I\ndidn't make any code changes, but I did have to do some reverse engineering.\n\nBecause, of course, I hadn't left myself good notes and some of the wires had\ncome undone over the past year.  My poor NES controller was looking sad with\nwires just kind of crammed into it.  But, it still worked.\n\nI refreshed the thing just enough to make it live to see another day. We\ndidn't hand out candy that year, though, so the thing just decorated my office\nfor awhile. <br style=\"clear:both\">\n\n## v3.0 (2017)\n\n<!--\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37852469272/in/datetaken/\" title=\"Pumpkin meets hot glue\"><img class=\"inset wide right\" src=\"hot-glue.jpg\" alt=\"Pumpkin meets hot glue\"></a>\n-->\n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/24031281868/in/datetaken/\" title=\"20171022_203806\"><img id=\"thumbnail\" class=\"inset wide left\" src=\"pumpkin.jpg\" alt=\"20171022_203806\"></a>\n\nAnother Halloween and I felt an urge to get more ambitious: I’d picked up that\nArduino at a Maker Faire back in 2011, pretty far from state of the art these \ndays. \n\nI’d been reading about the [ESP8266][] -\na cheap and tiny WiFi module that had been repurposed for\nmore tinkery things.  In fact, I read that you could even flash unmodified\nArduino sketches onto the thing.\n\n[esp8266]: https://www.espressif.com/en/products/hardware/esp8266ex/overview\n\n<!--\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/24031428708/in/datetaken/\" title=\"Creepy pumpkin eyes\"><img class=\"inset wide left\" src=\"creepy.jpg\" alt=\"Creepy pumpkin eyes\"></a>\n-->\n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37626526390/in/datetaken/\" title=\"20171019_233614\"><img class=\"inset wide left\" src=\"interior.jpg\" alt=\"20171019_233614\"></a>\n\nSo, I ordered [an ESP8266 dev board][nodemcu] and four more [8x8 LED\nmatrices][matrix] for a mouth.\nIt took me an hour to [port my old Arduino sketch over][ported],\nincluding the time to set up the dev stack. The eyes came alive on\nthe new hardware in very short order. Another hour and I had the\nmouth animating.\n\n[nodemcu]: http://a.co/8zPcmQ5 \n[matrix]: http://a.co/3Mc3qZZ\n[ported]: https://github.com/lmorchard/arduino-sketches/blob/master/nodemcu/nespad_eyes/nespad_eyes.ino\n\n<!--\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37852235042/in/datetaken/\" title=\"20171017_005235\"><img class=\"inset wide left\" src=\"mouth.jpg\" alt=\"20171017_005235\"></a>\n-->\n\n<!--\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37173755914/in/datetaken/\" title=\"20171021_230802\"><img class=\"inset wide left\" src=\"missing-column.jpg\" alt=\"20171021_230802\"></a>\n-->\n\nA bit more carving, and I was ready to install the mouth. I switched\nfrom gaffer tape to hot glue to make things more permanent. Alas, somehow I\ndamaged a column of LEDs in the process. But, oh well: I just gave it fangs.\n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37626516700/in/datetaken/\" title=\"20171019_233504\"><img class=\"inset wide left\" src=\"plugs.jpg\" alt=\"20171019_233504\"></a>\n\n<!--\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37626520570/in/datetaken/\" title=\"20171019_233530\"><img class=\"inset wide wide left\" src=\"plugged-in.jpg\" alt=\"20171019_233530\"></a>\n-->\n\nTo tidy the whole thing up, I bought extension cables for USB power and the NES\ngamepad. I hacked those up and hot glued them into the back of the pumpkin. \n\nWhen I was done, I had no cables trailing out from the inside of the thing. And, I could\nstop shoving bare wires into the end of an NES pad. And, if I wanted to go\ncompletely wireless, I could drop a USB power bank into the top and just\nconnect it from inside.\n<br style=\"clear:both\">\n\n## v4.0 (2017)\n\nBut, speaking of completely wireless: Back at the start, I'd\nconsidered using a Raspberry Pi.  Given a USB wifi adapter, I could have\nwritten a little web app to use as a remote control for the pumpkin. I still\nwanted to make that happen.\n\nI knew this ESP8266 thing was handy, but I didn't realize just how handy until I did some more research. I found an interesting set of libraries to glue together:\n\n* [ESP8266 Arduino core][espcore] - this let me port my sketch over mostly unmodified\n* [SPIFFS][] - offers an onboard filesystem in flash memory\n* [ESP8266WebServer][] - an embedded webserver that [serves up static files from SPIFFS][servestatic] and lets me handle some URL routes with C code\n* [arduinoWebsockets][] - websockets server and client libraries\n* [WiFiManager][] - code to fire up an temporary Access Point with a captive web portal to bootstrap wifi configuration - great for a device with no screen or keyboard\n\n[espcore]: https://github.com/esp8266/Arduino\n[SPIFFS]:http://esp8266.github.io/Arduino/versions/2.0.0/doc/filesystem.html \n[servestatic]: https://github.com/esp8266/Arduino/tree/master/libraries/ESP8266WebServer/examples/FSBrowser \n[arduinoWebsockets]: https://github.com/Links2004/arduinoWebSockets\n[ESP8266WebServer]: https://github.com/esp8266/Arduino/tree/master/libraries/ESP8266WebServer\n[WiFiManager]: https://github.com/tzapu/WiFiManager\n\nLong story short, I used all the above to produce this masterpiece:\n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/24031282388/in/datetaken/\" title=\"Screenshot_20171023-004211\"><img class=\"fullwidth\" src=\"controls.jpg\" alt=\"Screenshot_20171023-004211\"></a>\n\nWhat you're looking at is the wifi remote control for my pumpkin. The big yellow square is a virtual touchpad - dragging my finger across it moves the eyeballs. Tapping \"Blink\" makes the eyes blink, while \"Talk\" makes the mouth open & close.\n\nIt's a little web page loaded up from the onboard file system. It connects back to a websocket server that [accepts a bunch of little commands][wscmds] - which, oddly enough, map directly to NES pad buttons so I could be lazy and just reuse all the same code paths.\n\n[wscmds]: https://github.com/lmorchard/arduino-sketches/blob/master/nodemcu/nespad_eyes/nespad_eyes.ino#L324 \n\nBuilding this went way easier than I expected. Sure, it's embarassing code that anyone sensible would shred in a code review. But, it was fun hacking and works pretty much like I hoped it would. In particular, I was surprised at how responsive it ended up being. Without any optimization, it follows my taps and drags without noticible lag.\n\nSo, for another year, I sat next to an animated glowing pumpkin while I handed\nout candy. But this time, I played amateur ventriloquist and had the thing\ntalking to kids while I prodded at my cell phone. Pretty awkward and nerdy, but\nI think some folks appreciated it. They humored me, at least.\n\n## v5.0? What's next?\n\nA few months later, this project is lying fallow. It’s on display in my office, where I can watch the semi-random idle gibbering whenever I like. And though I haven't gotten back to any ESP8266 tinkering since October, I'm still kind of musing over what I could hack together next.\n\n<a data-flickr-embed=\"true\"  href=\"https://www.flickr.com/photos/deusx/37885815451/in/datetaken/\" title=\"20171023_144656\"><img class=\"fullwidth\" src=\"in-office.jpg\" alt=\"20171023_144656\"></a>\n\nIt feels weird to say it, but this project might be done: this pumpkin seems pretty close to my original idea. \n\nI’ve mused about maybe building some sort of voice assistant into it: talk to the pumpkin, control things around the house, hear about the weather, order it to fire candy into kids’ bags with tiny trebuchets - who knows?\n\nI could upgrade from LED matrices to [full-blown OLED screens][oled]. Though, if I did that, I've got a notion to build myself a replica of 790 from Lexx. I'd probably regret it, but he seems more my kind of personal assistant than current offerings like Alexa or Siri:\n\n<div style=\"position: relative; padding-bottom: 56.25%;\">\n  <iframe class=\"lazyload\" style=\"position: absolute; top: 0; left: 0; width: 100%; height: 100%;\" src=\"\" data-src=\"https://www.youtube.com/embed/s8d1mfLa5Vk\" frameborder=\"0\" gesture=\"media\" allow=\"encrypted-media\" allowfullscreen></iframe>\n</div>\n\n[oled]: https://learn.adafruit.com/animated-electronic-eyes-using-teensy-3-1/overview\n\nI've also been thinking bigger: Like, what if I turned my *house* into an animated character? Combine some [ESP8266's with AC relays][sonoff] and orchestrate strings of holiday lights into something animated? I could be *that* guy on the block!\n\nAnyway, let me know what you think!\n\n[sonoff]: https://www.itead.cc/sonoff-wifi-wireless-switch.html\n\n<script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\n<!-- vim: set wrap linebreak nolist wrapmargin=0 textwidth=0 syntax=markdown formatoptions-=t: -->\n",
    "parentPath": "../blog.lmorchard.com/posts/2018-02-08-pumpkin",
    "path": "2018/02/08/pumpkin",
    "thumbnail": "https://lmorchard.github.io/blog.lmorchard.com//2018/02/08/pumpkin/pumpkin.jpg",
    "summary": "<p><strong>TL;DR</strong>: I made a wifi pumpkin using an ESP8266 with LED matrix eyes and mouth.\nI added a web-based remote control for my phone using websockets. It was fun!</p>\n"
  }
]