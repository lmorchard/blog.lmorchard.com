{"comments_archived":true,"date":"2005-08-19T00:00:00.000Z","layout":"post","title":"Super-fast DummyPants Addressbarlet for del.icio.us","wordpress_id":676,"wordpress_slug":"dummypants","wordpress_url":"http://www.decafbad.com/blog/?p=676","url":"/2005/08/19/dummypants/","summary":"<p>Okay, so lately I&apos;ve switched to using &quot;<a href=\"http://naeblis.cx/rtomayko/2004/08/09/DeliciousAddresslets\">addressbarlets</a>&quot; for my <a href=\"http://del.icio.us\">del.icio.us</a> posting needs.  In particular, I&apos;ve been using the <a href=\"http://ejohn.org/blog/super-fast-delicious-bookmarklet/\">Super-Fast variety</a>.  I cannot stress how much better these are than clicking links in the bookmark toolbar.  My <a href=\"http://del.icio.us\">del.icio.us</a> posting has converged that much closer to command-line / QuickSilver perfection.  </p>\n<p>But, I just noticed that in my <a href=\"http://del.icio.us\">del.icio.us</a> RSS feed, the title &quot;<strong>del.icio.us warning: non-utf8 string! (sorry)</strong>&quot; has been popping up--especially on <a href=\"http://dev.upian.com/hotlinks/\">Hot Links</a>, which includes my links on a regular basis.  </p>\n<p>Well, although I&apos;m not really all that hip to unicode and non-ASCII characters, it appears that things like <a href=\"http://daringfireball.net/projects/smartypants/\">SmartyPants</a> and the <a href=\"http://www.365tomorrows.com/08/19/deo%e2%80%99s-hole/\">use of chevrons in page titles</a> are throwing the monkey wrench for me when the addressbarlet picks up the <code>document.title</code>.  So, I decided to do a little sloppy butchery in my bookmarklet code to wrestle these titles into something acceptable.</p>\n<p>After you&apos;ve had a chance to try out / comprehend <a href=\"http://ejohn.org/blog/super-fast-delicious-bookmarklet/\">the original versions</a>, take a look at this revised addressbarlet:</p>\n<ul>\n<li><a href=\"javascript:u=%22CHANGEME%22;us=[[&apos;\\u201C&apos;,&apos;%22&apos;],[&apos;\\u201D&apos;,&apos;%22&apos;],[&apos;\\u2019&apos;,%22&apos;%22],[&apos;\\u2018&apos;,%22&apos;%22],[&apos;\\u2026&apos;,%22...%22],[&apos;\\u00BB&apos;,&apos;-&apos;]];function es(p){for(var i=0;i&lt;us.length;i++){p=p.replace(us[i][0],us[i][1])};p=p.replace(/[\\u0080-\\uFFFF]/g,&apos;&apos;);return encodeURIComponent(p);};q=location.href;e=%22%22+(window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection.createRange().text);p=document.title;window.location.href=%22http://del.icio.us/%22+u+%22?jump=doclose&amp;tags=%22+es(%22%s%22)+%22&amp;url=%22+es(q)+%22&amp;description=%22+es(p)+%22&amp;extended=%22+es(&apos;%22&apos;+e+&apos;%22&apos;).replace(/ /g,%22+%22);\">Post to del.icio.us and close</a></li>\n</ul>\n<p>In case, for some reason, that doesn&apos;t come through in this entry, here&apos;s the code which should appear in the HREF:</p>\n<textarea rows=\"10\" cols=\"65\" name=\"code\" class=\"javascript\">\n    javascript:u=%22CHANGEME%22;us=[[&apos;\\u201C&apos;,&apos;%22&apos;],[&apos;\\u201D&apos;,&apos;%22&apos;],[&apos;\\u2019&apos;,%22&apos;%22],[&apos;\\u2018&apos;,%22&apos;%22],[&apos;\\u2026&apos;,%22...%22],[&apos;\\u00BB&apos;,&apos;-&apos;]];function es(p){for(var i=0;i&lt;us .length;i++){p=p.replace(us[i][0],us[i][1])};p=p.replace(/[\\u0080-\\uFFFF]/g,&apos;&apos;);return encodeURIComponent(p);};q=location.href;e=%22%22+(window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection.createRange().text);p=document.title;window.location.href=%22<a href=\"http://del.icio.us/%22+u+%22?jump=doclose&amp;tags=%22+es(%22%s%22)+%22&amp;url=%22+es(q)+%22&amp;description=%22+es(p)+%22&amp;extended=%22+es(&apos;%22&apos;+e+&apos;%22&apos;).replace\">http://del.icio.us/%22+u+%22?jump=doclose&amp;tags=%22+es(%22%s%22)+%22&amp;url=%22+es(q)+%22&amp;description=%22+es(p)+%22&amp;extended=%22+es(&apos;%22&apos;+e+&apos;%22&apos;).replace</a>(/ /g,%22+%22);</textarea>\n\n<p>I&apos;m sure I have a few nasty bugs lurking in there, but basically I&apos;m trying to reverse <a href=\"http://daringfireball.net/projects/smartypants/\">SmartyPants</a>--DummyPants, if you will--and crudely hack out everything that&apos;s not the usual ASCII.</p>\n<p>If you happen to be having this problem, let me know if this code works for you.</p>\n","path":"2005/08/19/dummypants","content":"<p>Okay, so lately I&#39;ve switched to using &quot;<a href=\"http://naeblis.cx/rtomayko/2004/08/09/DeliciousAddresslets\">addressbarlets</a>&quot; for my <a href=\"http://del.icio.us\">del.icio.us</a> posting needs.  In particular, I&#39;ve been using the <a href=\"http://ejohn.org/blog/super-fast-delicious-bookmarklet/\">Super-Fast variety</a>.  I cannot stress how much better these are than clicking links in the bookmark toolbar.  My <a href=\"http://del.icio.us\">del.icio.us</a> posting has converged that much closer to command-line / QuickSilver perfection.  </p>\n<p>But, I just noticed that in my <a href=\"http://del.icio.us\">del.icio.us</a> RSS feed, the title &quot;<strong>del.icio.us warning: non-utf8 string! (sorry)</strong>&quot; has been popping up--especially on <a href=\"http://dev.upian.com/hotlinks/\">Hot Links</a>, which includes my links on a regular basis.  </p>\n<p>Well, although I&#39;m not really all that hip to unicode and non-ASCII characters, it appears that things like <a href=\"http://daringfireball.net/projects/smartypants/\">SmartyPants</a> and the <a href=\"http://www.365tomorrows.com/08/19/deo%e2%80%99s-hole/\">use of chevrons in page titles</a> are throwing the monkey wrench for me when the addressbarlet picks up the <code>document.title</code>.  So, I decided to do a little sloppy butchery in my bookmarklet code to wrestle these titles into something acceptable.</p>\n<p>After you&#39;ve had a chance to try out / comprehend <a href=\"http://ejohn.org/blog/super-fast-delicious-bookmarklet/\">the original versions</a>, take a look at this revised addressbarlet:</p>\n<ul>\n<li><a href=\"javascript:u=%22CHANGEME%22;us=[['\\u201C','%22'],['\\u201D','%22'],['\\u2019',%22'%22],['\\u2018',%22'%22],['\\u2026',%22...%22],['\\u00BB','-']];function es(p){for(var i=0;i<us.length;i++){p=p.replace(us[i][0],us[i][1])};p=p.replace(/[\\u0080-\\uFFFF]/g,'');return encodeURIComponent(p);};q=location.href;e=%22%22+(window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection.createRange().text);p=document.title;window.location.href=%22http://del.icio.us/%22+u+%22?jump=doclose&#38;tags=%22+es(%22%s%22)+%22&#38;url=%22+es(q)+%22&#38;description=%22+es(p)+%22&#38;extended=%22+es('%22'+e+'%22').replace(/ /g,%22+%22);\">Post to del.icio.us and close</a></li>\n</ul>\n<p>In case, for some reason, that doesn&#39;t come through in this entry, here&#39;s the code which should appear in the HREF:</p>\n<textarea rows=\"10\" cols=\"65\" name=\"code\" class=\"javascript\">\n    javascript:u=%22CHANGEME%22;us=[[&#39;\\u201C&#39;,&#39;%22&#39;],[&#39;\\u201D&#39;,&#39;%22&#39;],[&#39;\\u2019&#39;,%22&#39;%22],[&#39;\\u2018&#39;,%22&#39;%22],[&#39;\\u2026&#39;,%22...%22],[&#39;\\u00BB&#39;,&#39;-&#39;]];function es(p){for(var i=0;i&lt;us .length;i++){p=p.replace(us[i][0],us[i][1])};p=p.replace(/[\\u0080-\\uFFFF]/g,&#39;&#39;);return encodeURIComponent(p);};q=location.href;e=%22%22+(window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection.createRange().text);p=document.title;window.location.href=%22<a href=\"http://del.icio.us/%22+u+%22?jump=doclose&#38;tags=%22+es(%22%s%22)+%22&#38;url=%22+es(q)+%22&#38;description=%22+es(p)+%22&#38;extended=%22+es(&#39;%22&#39;+e+&#39;%22&#39;).replace\">http://del.icio.us/%22+u+%22?jump=doclose&#38;tags=%22+es(%22%s%22)+%22&#38;url=%22+es(q)+%22&#38;description=%22+es(p)+%22&#38;extended=%22+es(&#39;%22&#39;+e+&#39;%22&#39;).replace</a>(/ /g,%22+%22);</textarea>\n\n<p>I&#39;m sure I have a few nasty bugs lurking in there, but basically I&#39;m trying to reverse <a href=\"http://daringfireball.net/projects/smartypants/\">SmartyPants</a>--DummyPants, if you will--and crudely hack out everything that&#39;s not the usual ASCII.</p>\n<p>If you happen to be having this problem, let me know if this code works for you.</p>\n<!--more-->\n<p>shortname=dummypants</us></textarea></p>\n<div id=\"comments\" class=\"comments archived-comments\">\n            <h3>Archived Comments</h3>\n\n        <ul class=\"comments\">\n\n        <li class=\"comment\" id=\"comment-221088797\">\n            <div class=\"meta\">\n                <div class=\"author\">\n                    <a class=\"avatar image\" rel=\"nofollow\" \n                       href=\"http://plasmasturm.org/\"><img src=\"http://www.gravatar.com/avatar.php?gravatar_id=e17949267bbfe21a0fadf1bbf00592b4&amp;size=32&amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png\"/></a>\n                    <a class=\"avatar name\" rel=\"nofollow\" \n                       href=\"http://plasmasturm.org/\">Aristotle Pagaltzis</a>\n                </div>\n                <a href=\"#comment-221088797\" class=\"permalink\"><time datetime=\"2005-08-20T00:47:22\">2005-08-20T00:47:22</time></a>\n            </div>\n            <div class=\"content\">del.icio.us understands UTF-8 (which is exactly what the message says, after all), and the characters you remove are expressed in Unicode codepoints.\n\nThe disconnect seems to happen when the page you&#39;re on is in an encoding other than UTF-8, in which case Firefox apparently escapes characters using their byte values from that encoding in <code>encodeURIComponent</code>. I have no idea why, or exactly where this problem happens; the JS docs say the function should always use the UTF-8 representation for the byte values.</div>\n\n<pre><code>    &lt;/li&gt;\n\n    &lt;li class=&quot;comment&quot; id=&quot;comment-221088798&quot;&gt;\n        &lt;div class=&quot;meta&quot;&gt;\n            &lt;div class=&quot;author&quot;&gt;\n                &lt;a class=&quot;avatar image&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://ejohn.org/&quot;&gt;&lt;img src=&quot;http://www.gravatar.com/avatar.php?gravatar_id=b3e04a46e85ad3e165d66f5d927eb609&amp;amp;size=32&amp;amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png&quot;/&gt;&lt;/a&gt;\n                &lt;a class=&quot;avatar name&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://ejohn.org/&quot;&gt;John Resig&lt;/a&gt;\n            &lt;/div&gt;\n            &lt;a href=&quot;#comment-221088798&quot; class=&quot;permalink&quot;&gt;&lt;time datetime=&quot;2005-08-20T19:30:38&quot;&gt;2005-08-20T19:30:38&lt;/time&gt;&lt;/a&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;content&quot;&gt;A very smart improvement of the original - I like it! I&#39;ll see if I can&#39;t include a link to it, before I forget.&lt;/div&gt;\n\n    &lt;/li&gt;\n\n    &lt;/ul&gt;\n\n    &lt;/div&gt;\n</code></pre>"}