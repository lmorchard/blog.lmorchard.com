{"comments_archived":true,"date":"2004-09-15T00:00:00.000Z","excerpt":"So... am I missing a more elegant RESTful way of doing this which\ndoesn't result in a quadrillion HTTP requests?","layout":"post","tags":["xml"],"title":"Manipulating aggregate resources in a REST API?","wordpress_id":547,"wordpress_slug":"manipulating-aggregate-resources-in-a-rest-api","wordpress_url":"http://www.decafbad.com/blog/?p=547","url":"/2004/09/15/manipulating-aggregate-resources-in-a-rest-api/","path":"2004/09/15/manipulating-aggregate-resources-in-a-rest-api","content":"<p>Here&#39;s a tiny bit of a REST-ian quandary:  I&#39;m working through this API for <code>dbagg3</code>.  The major resources involved include <strong>subscriptions</strong> and <strong>entries</strong>.  Quite often, while working on the UI, I find a need to manipulate ranges and collections of these resources-- things like: &#8220;mark these 12 entries as read&#8221; and &#8220;give me an aggregate of the new entries for these 6 subscriptions&#8221;.</p>\n<p>So, I have been using URLs like the following:</p>\n<ul>\n<li><code>POST /subscriptions/523/entries/12322,12326,12325,12388,12412/notes/</code></li>\n<li><code>GET /subscriptions/312,443,523/now-12.xml</code></li>\n</ul>\n<p>Doing things this way is terribly convenient with regard to stuffing many things into one HTTP request.  Problem is, with respect to REST, these URLs no longer refer to individual resources--  they&#39;re aggregate references.</p>\n<p>I&#39;ve been thinking about this apparent break with the REST philosophy, and was reminded of it after skimming through <a href=\"http://www.markbaker.ca/Talks/2004-xmlself/all.htm\">Mark Baker&#39;s notes on a talk</a> today.  </p>\n<p>So... am I missing a more elegant RESTful way of doing this which doesn&#39;t result in a quadrillion HTTP requests?</p>\n<div id=\"comments\" class=\"comments archived-comments\">\n            <h3>Archived Comments</h3>\n\n        <ul class=\"comments\">\n\n        <li class=\"comment\" id=\"comment-221090514\">\n            <div class=\"meta\">\n                <div class=\"author\">\n                    <a class=\"avatar image\" rel=\"nofollow\" \n                       href=\"http://trevor.smith.name/\"><img src=\"http://www.gravatar.com/avatar.php?gravatar_id=e873edb1d1943ea7087468439ce64d37&amp;size=32&amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png\"/></a>\n                    <a class=\"avatar name\" rel=\"nofollow\" \n                       href=\"http://trevor.smith.name/\">Trevor F. Smith</a>\n                </div>\n                <a href=\"#comment-221090514\" class=\"permalink\"><time datetime=\"2004-09-15T16:29:16\">2004-09-15T16:29:16</time></a>\n            </div>\n            <div class=\"content\">Even the most stringent of REST advocates will break down and use reasonable parameters for adjectives, adverbs and unusual qualifiers.  Leave the path for nouns and verbs.</div>\n\n<pre><code>    &lt;/li&gt;\n\n    &lt;li class=&quot;comment&quot; id=&quot;comment-221090515&quot;&gt;\n        &lt;div class=&quot;meta&quot;&gt;\n            &lt;div class=&quot;author&quot;&gt;\n                &lt;a class=&quot;avatar image&quot; rel=&quot;nofollow&quot; \n                   href=&quot;&quot;&gt;&lt;img src=&quot;http://www.gravatar.com/avatar.php?gravatar_id=ad3bec4560b1c5d0ffddddc497c8b1e0&amp;amp;size=32&amp;amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png&quot;/&gt;&lt;/a&gt;\n                &lt;a class=&quot;avatar name&quot; rel=&quot;nofollow&quot; \n                   href=&quot;&quot;&gt;Jeremy Dunck&lt;/a&gt;\n            &lt;/div&gt;\n            &lt;a href=&quot;#comment-221090515&quot; class=&quot;permalink&quot;&gt;&lt;time datetime=&quot;2004-09-15T17:06:44&quot;&gt;2004-09-15T17:06:44&lt;/time&gt;&lt;/a&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;content&quot;&gt;PUT /aggregates/312,443,523\n</code></pre><p>1</p>\n<hr>\n<p>GET /aggregates/1/now-12.xml</div></p>\n<pre><code>    &lt;/li&gt;\n\n    &lt;li class=&quot;comment&quot; id=&quot;comment-221090516&quot;&gt;\n        &lt;div class=&quot;meta&quot;&gt;\n            &lt;div class=&quot;author&quot;&gt;\n                &lt;a class=&quot;avatar image&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://franklinmint.fm&quot;&gt;&lt;img src=&quot;http://www.gravatar.com/avatar.php?gravatar_id=b9ed774661a22ff8797a1e0e24f0baf3&amp;amp;size=32&amp;amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png&quot;/&gt;&lt;/a&gt;\n                &lt;a class=&quot;avatar name&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://franklinmint.fm&quot;&gt;Robert Sayre&lt;/a&gt;\n            &lt;/div&gt;\n            &lt;a href=&quot;#comment-221090516&quot; class=&quot;permalink&quot;&gt;&lt;time datetime=&quot;2004-09-15T18:08:17&quot;&gt;2004-09-15T18:08:17&lt;/time&gt;&lt;/a&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;content&quot;&gt;Lessons from WebDAV&lt;/div&gt;\n\n    &lt;/li&gt;\n\n    &lt;li class=&quot;comment&quot; id=&quot;comment-221090517&quot;&gt;\n        &lt;div class=&quot;meta&quot;&gt;\n            &lt;div class=&quot;author&quot;&gt;\n                &lt;a class=&quot;avatar image&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://www.shearersoftware.com/personal/weblog/&quot;&gt;&lt;img src=&quot;http://www.gravatar.com/avatar.php?gravatar_id=4654316e8388b2e83af98a3118d976bb&amp;amp;size=32&amp;amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png&quot;/&gt;&lt;/a&gt;\n                &lt;a class=&quot;avatar name&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://www.shearersoftware.com/personal/weblog/&quot;&gt;Andrew Shearer&lt;/a&gt;\n            &lt;/div&gt;\n            &lt;a href=&quot;#comment-221090517&quot; class=&quot;permalink&quot;&gt;&lt;time datetime=&quot;2004-09-15T18:43:59&quot;&gt;2004-09-15T18:43:59&lt;/time&gt;&lt;/a&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;content&quot;&gt;Interesting method, Jeremy.\n</code></pre><p>The revised GET request looks closer to the REST philosophy to me than the original. The thing that worries me is that now you&#39;re generating state on the server (a new &quot;aggregate resource&quot; with its own identifier), and it&#39;s not clear that it&#39;s needed. How long does the server have to keep the list around? Could other clients access it if they guessed the ID?</p>\n<p>It&#39;s the PUT request that causes the problems. It&#39;s a high price to pay for a modest improvement in the GET request.</p>\n<p>On second thought, I don&#39;t see much wrong with the original. URLs can be algorithmic, and this one just happens to refer to a list of things. The thing that throws it into a different mental category for me is probably the combinatorial explosion. But does it really matter that now, for practical purposes, the REST service could no longer be fully indexed by search engines?</div></p>\n<pre><code>    &lt;/li&gt;\n\n    &lt;li class=&quot;comment&quot; id=&quot;comment-221090519&quot;&gt;\n        &lt;div class=&quot;meta&quot;&gt;\n            &lt;div class=&quot;author&quot;&gt;\n                &lt;a class=&quot;avatar image&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://www.scifihifi.com&quot;&gt;&lt;img src=&quot;http://www.gravatar.com/avatar.php?gravatar_id=266511c4b3124a981ccd3b1716e0bb0b&amp;amp;size=32&amp;amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png&quot;/&gt;&lt;/a&gt;\n                &lt;a class=&quot;avatar name&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://www.scifihifi.com&quot;&gt;Buzz Andersen&lt;/a&gt;\n            &lt;/div&gt;\n            &lt;a href=&quot;#comment-221090519&quot; class=&quot;permalink&quot;&gt;&lt;time datetime=&quot;2004-09-15T19:57:21&quot;&gt;2004-09-15T19:57:21&lt;/time&gt;&lt;/a&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;content&quot;&gt;I&#39;ve wondered about this in the context of an application I&#39;m designing that allows wildcard queries (e.g. /id/1*/details.html) as part of the URL path.  To me, it seems OK to do that, from REST&#39;s &quot;document-centric&quot; viewpoint, since it seems reasonable that I could actually have an actual document with that path.  Your original GET request seems like the same thing to me.\n</code></pre><p>I could be completely wrong though--I&#39;d be the first to admit that I still find REST a bit difficult to pin down.  It seems like it&#39;s a lot like the old saw about pornography: I can&#39;t define it, but I know it when I see it :-).</div></p>\n<pre><code>    &lt;/li&gt;\n\n    &lt;li class=&quot;comment&quot; id=&quot;comment-221090520&quot;&gt;\n        &lt;div class=&quot;meta&quot;&gt;\n            &lt;div class=&quot;author&quot;&gt;\n                &lt;a class=&quot;avatar image&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://www.scifihifi.com&quot;&gt;&lt;img src=&quot;http://www.gravatar.com/avatar.php?gravatar_id=266511c4b3124a981ccd3b1716e0bb0b&amp;amp;size=32&amp;amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png&quot;/&gt;&lt;/a&gt;\n                &lt;a class=&quot;avatar name&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://www.scifihifi.com&quot;&gt;Buzz Andersen&lt;/a&gt;\n            &lt;/div&gt;\n            &lt;a href=&quot;#comment-221090520&quot; class=&quot;permalink&quot;&gt;&lt;time datetime=&quot;2004-09-15T20:55:05&quot;&gt;2004-09-15T20:55:05&lt;/time&gt;&lt;/a&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;content&quot;&gt;Upon further reading: isn&#39;t Jeremy&#39;s method wrong per Paul Prescod&#39;s &quot;Common REST Mistakes&quot; (http://www.prescod.net/rest/mistakes/)?  In particular:\n</code></pre><p>&quot;Do not invent proprietary object  identifiers.&quot;</p>\n<p>And...</p>\n<p>&quot;If you use URI syntax with UUIDs or something like that then you  get half of the benefit of URIs. You get a standardized syntax but have no standardized dereferencing capability.&quot;</p>\n<p>Essentially, only the client that did the post and stored the ID in Jeremy&#39;s example would have a way of referencing that set.</p>\n<p>Am I wrong?</div></p>\n<pre><code>    &lt;/li&gt;\n\n    &lt;li class=&quot;comment&quot; id=&quot;comment-221090521&quot;&gt;\n        &lt;div class=&quot;meta&quot;&gt;\n            &lt;div class=&quot;author&quot;&gt;\n                &lt;a class=&quot;avatar image&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://blog.ianbicking.org&quot;&gt;&lt;img src=&quot;http://www.gravatar.com/avatar.php?gravatar_id=cc8334869c9d2a9e603017f2da805eb3&amp;amp;size=32&amp;amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png&quot;/&gt;&lt;/a&gt;\n                &lt;a class=&quot;avatar name&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://blog.ianbicking.org&quot;&gt;Ian Bicking&lt;/a&gt;\n            &lt;/div&gt;\n            &lt;a href=&quot;#comment-221090521&quot; class=&quot;permalink&quot;&gt;&lt;time datetime=&quot;2004-09-16T11:12:56&quot;&gt;2004-09-16T11:12:56&lt;/time&gt;&lt;/a&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;content&quot;&gt;To expand on WebDAV, certain WebDAV operations produce compound requests and responses, all packaged in XML.  I can&#39;t remember what they look like, but it&#39;s really nothing more than several HTTP requests packaged in XML.  They use it for doing atomic operations on several files/resources.  It&#39;s kind of REST, kind of anti-REST.\n</code></pre><p>Otherwise, of course, the query string is reasonably unordered and allows multiple pieces of data, i.e., /subscriptions/now-12.xml?id=1&amp;id=2&amp;id=3</p>\n<p>Another option is to somehow define sets.  E.g., something like POST /createset (request body contains the IDs) and then the server responds with an identifier for that set, and then you work with that identifier.</div></p>\n<pre><code>    &lt;/li&gt;\n\n    &lt;li class=&quot;comment&quot; id=&quot;comment-221090522&quot;&gt;\n        &lt;div class=&quot;meta&quot;&gt;\n            &lt;div class=&quot;author&quot;&gt;\n                &lt;a class=&quot;avatar image&quot; rel=&quot;nofollow&quot; \n                   href=&quot;&quot;&gt;&lt;img src=&quot;http://www.gravatar.com/avatar.php?gravatar_id=d0d0148e03ff9f1639cab8b35bf625db&amp;amp;size=32&amp;amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png&quot;/&gt;&lt;/a&gt;\n                &lt;a class=&quot;avatar name&quot; rel=&quot;nofollow&quot; \n                   href=&quot;&quot;&gt;Ken Meltsner&lt;/a&gt;\n            &lt;/div&gt;\n            &lt;a href=&quot;#comment-221090522&quot; class=&quot;permalink&quot;&gt;&lt;time datetime=&quot;2004-09-16T15:31:28&quot;&gt;2004-09-16T15:31:28&lt;/time&gt;&lt;/a&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;content&quot;&gt;You could have the system return an existing identifier as the response to sending it a set of identifiers, if that set has already been defined.\n</code></pre><p>That is, treat the GET as more of a &quot;return existing or create a new one&quot; operation.  And if you want to be really consistent, allow sets to include other sets.</p>\n<p>Perhaps something like:</p>\n<p>GET /setID/entries/12322,12326,12325,12388,12412</p>\n<p>would return </p>\n<p>912345678</p>\n<p>the first time and all following times, and then 912345678 could be used from then on.</p>\n<p>I think this would be idempotent, cache-friendly, etc.</div></p>\n<pre><code>    &lt;/li&gt;\n\n    &lt;li class=&quot;comment&quot; id=&quot;comment-221090523&quot;&gt;\n        &lt;div class=&quot;meta&quot;&gt;\n            &lt;div class=&quot;author&quot;&gt;\n                &lt;a class=&quot;avatar image&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://www.markbaker.ca&quot;&gt;&lt;img src=&quot;http://www.gravatar.com/avatar.php?gravatar_id=05a5272a087ce9a44bd5f050932d7a28&amp;amp;size=32&amp;amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png&quot;/&gt;&lt;/a&gt;\n                &lt;a class=&quot;avatar name&quot; rel=&quot;nofollow&quot; \n                   href=&quot;http://www.markbaker.ca&quot;&gt;Mark Baker&lt;/a&gt;\n            &lt;/div&gt;\n            &lt;a href=&quot;#comment-221090523&quot; class=&quot;permalink&quot;&gt;&lt;time datetime=&quot;2004-09-26T14:03:39&quot;&gt;2004-09-26T14:03:39&lt;/time&gt;&lt;/a&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;content&quot;&gt;Yah, REST isn&#39;t ideal for dealing with sets of resources since most operations on sets are specific to sets and therefore not uniform.  Consider the equivalent of a &quot;FILL&quot; operation, which would be a PUT on everything in a set of resources, where the set was identified by the HTTP Request-URI.\n</code></pre><p>WebDAV can help with its collections stuff, but sometimes that&#39;s overkill.  When I&#39;ve encountered this, I&#39;ve simply created a resource for the set and a POST on it changes the state of all the members of the set.  Not RESTful, but so long as you understand the architectural consequences, that&#39;s ok.</div></p>\n<pre><code>    &lt;/li&gt;\n\n    &lt;li class=&quot;comment&quot; id=&quot;comment-221090524&quot;&gt;\n        &lt;div class=&quot;meta&quot;&gt;\n            &lt;div class=&quot;author&quot;&gt;\n                &lt;a class=&quot;avatar image&quot; rel=&quot;nofollow&quot; \n                   href=&quot;&quot;&gt;&lt;img src=&quot;http://www.gravatar.com/avatar.php?gravatar_id=ad3bec4560b1c5d0ffddddc497c8b1e0&amp;amp;size=32&amp;amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png&quot;/&gt;&lt;/a&gt;\n                &lt;a class=&quot;avatar name&quot; rel=&quot;nofollow&quot; \n                   href=&quot;&quot;&gt;Jeremy Dunck&lt;/a&gt;\n            &lt;/div&gt;\n            &lt;a href=&quot;#comment-221090524&quot; class=&quot;permalink&quot;&gt;&lt;time datetime=&quot;2004-10-05T15:17:52&quot;&gt;2004-10-05T15:17:52&lt;/time&gt;&lt;/a&gt;\n        &lt;/div&gt;\n        &lt;div class=&quot;content&quot;&gt;I&#39;m not a well-experienced, RESTian.  Thanks for the pointer to Prescod&#39;s piece.\n</code></pre><p>I was thinking what Ken later said (Sep 16 @ 3:31PM).</div></p>\n<pre><code>    &lt;/li&gt;\n\n    &lt;/ul&gt;\n\n    &lt;/div&gt;\n</code></pre>"}