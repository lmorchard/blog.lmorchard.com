<!DOCTYPE html>
    <html>
      <head>
        <title>XPath based Python dictionaries, on loan - blog.lmorchard.com</title>
        <meta property="og:type" content="article" />
        <meta property="og:site_name" content="blog.lmorchard.com" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="author" content="Les Orchard" />
        <meta
          name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"
        />
        <link
          rel="shortcut icon"
          href="https://www.gravatar.com/avatar/b45c48fc9e05922e2f368a9d7d7d8de1?s=16"
        />

        <script
          defer
          data-domain="blog.lmorchard.com"
          src="https://analytics.lmorchard.com/js/plausible.js"
        ></script>

        <link
          rel="stylesheet"
          type="text/css"
          href="/blog.lmorchard.com/index.css"
        />
        <script type="module" src="/blog.lmorchard.com/index.js"></script>

        <link
          href="https://lmorchard.github.io/blog.lmorchard.com/index.rss"
          rel="alternate"
          title="blog.lmorchard.com"
          type="application/rss+xml"
        />

        <link
                href="/blog.lmorchard.com/index.rss"
                rel="alternate"
                title="blog.lmorchard.com"
                type="application/rss+xml"
              />
        <meta property="og:title" content="XPath based Python dictionaries, on loan" />
        <meta
          property="og:url"
          content="https://lmorchard.github.io/blog.lmorchard.com/2004/09/01/xpath-based-python-dictionaries-on-loan/"
        />
      </head>
      <body>
        <header class="content-grid">
          <div class="masthead">
            <img src="https://www.gravatar.com/avatar/b45c48fc9e05922e2f368a9d7d7d8de1.jpg?s=128" />
            <div class="title">
              <h1>
                <a href="/blog.lmorchard.com/" title="blog.lmorchard.com">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="100%"
                    height="100%"
                    viewBox="0 0 250 20"
                  >
                    <text
                      lengthAdjust="spacing"
                      fill="currentColor"
                      y="16"
                      textLength="240"
                      x="5"
                    >
                      blog.lmorchard.com
                    </text>
                  </svg>
                </a>
              </h1>
              <h2>
                <rotating-tagline
                  random
                  initial="1"
                  period="7000"
                  src="/blog.lmorchard.com/taglines.json"
                >
                  <a href="/blog.lmorchard.com/" title="It&#39;s all spinning wheels &amp; self-doubt until the first pot of coffee.">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="100%"
                      height="100%"
                      viewBox="0 0 250 20"
                    >
                      <text
                        class="tagline"
                        lengthAdjust="spacing"
                        fill="currentColor"
                        y="16"
                        textLength="240"
                        x="5"
                      >
                        It&#39;s all spinning wheels &amp; self-doubt until the first pot of coffee.
                      </text>
                    </svg>
                  </a>
                </rotating-tagline>
              </h2>
            </div>
          </div>
          <nav class="main-nav">
            <div id="search"></div>
            <ul>
              <li>
                <a href="http://lmorchard.com/"
                  ><span class="fa fa-info-circle"></span> about me</a
                >
              </li>
              <li>
                <a href="/blog.lmorchard.com/archives.html"
                  ><span class="fa fa-archive"></span> archives</a
                >
              </li>
              <li>
                <a href="https://lmorchard.github.io/blog.lmorchard.com/index.rss" title="blog.lmorchard.com"
                  ><span class="fa fa-rss"></span> feed</a
                >
              </li>
              <li class="theme-selector">
                <theme-selector title="Enable dark theme">
                  <label>
                    <input type="checkbox" />
                    <span class="slider"></span>
                  </label>
                </theme-selector>
              </li>
            </ul>
          </nav>
        </header>

        <section class="main"><article
        data-pagefind-body
        class="content content-grid post tag-hackstag-xml"
      >
        <header>
          <time
            title="2004-09-01T06:47:41-04:00"
            pubdate="2004-09-01T06:47:41-04:00"
          >
            <span class="prevpost">
              <a
                title="Moving time again"
                href="/blog.lmorchard.com/2004/09/12/moving-time-again/"
                >&nbsp;<span class="fa fa-long-arrow-left"></span>&nbsp;</a
              >
            </span>
            <span class="postdate">
              <a href="/blog.lmorchard.com/2004/"
                >2004</a
              >
              &#8226;
              <a href="/blog.lmorchard.com/2004/09/"
                >September</a
              >
              &#8226;
              <span>01</span>
            </span>
            <span class="nextpost">
              <a
                title="Making progress on dbagg3"
                href="/blog.lmorchard.com/2004/08/30/dbagg3-makingprogress/"
                >&nbsp;<span class="fa fa-long-arrow-right"></span>&nbsp;</a
              >
            </span>
          </time>
          <h1 class="title">XPath based Python dictionaries, on loan</h1>
          <ul class="tags">
              <li><a href="/blog.lmorchard.com/tag/hacks/">hacks</a></li><li><a href="/blog.lmorchard.com/tag/xml/">xml</a></li>
            </ul>
        </header>

        <p>So <a href="http://www.xmldatabases.org/WK/blog">Kimbro Staken</a> posted this nifty idea to build <a href="http://www.xmldatabases.org/WK/blog/1964_XPath_based_Python_Dictionaries.item">XPath based Python dictionaries</a> to access XML data as a part of his incredibly nifty <a href="http://www.syncato.org/">Syncato</a> microcontent management system.  Eventually, I've really got to break down and get that thing built and running on my server and my laptop-- it really seems like I'm reinventing so many wheels by not basing <a href="http://www.decafbad.com/cvs/dbagg3/"><code>dbagg3</code></a> on it.</p>
<p>But, while I'm in the process of wheel reinvention, how about I borrow Kimbro's idea?  I just threw together <a href="http://www.decafbad.com/cvs/*checkout*/dbagg3/lib/dbagg3/xmlutils.py">a quick class called XPathDict</a>, based on <a href="http://www.xmlsoft.org/">libxml2</a>.  It works a little something like this:</p>
<pre><code>feed_xd = XPathDict(file="sample-atom.xml")
for entry_node in feed_xd.nodes("//atom:entry"):
    entry = XPathDict(doc=entry_node.doc, node=entry_node)
    print "Title: " % entry['atom:title']
    if 'atom:author' in entry:
        print "Author: " % entry['atom:author/atom:name']

xml = """
   &lt;dbagg3:user xmlns="http://purl.org/atom/ns#" 
            xmlns:dbagg3="http://decafbad.com/2004/07/dbagg3/"&gt;
        &lt;name&gt;deusx&lt;/name&gt;
        &lt;email&gt;deus_x@pobox.com&lt;/email&gt;
        &lt;url&gt;http://www.decafbad.com/&lt;/url&gt;
        &lt;dbagg3:prefs&gt;
            &lt;dbagg3:pref name="foo"&gt;bar&lt;/dbagg3:pref&gt;
        &lt;/dbagg3:prefs&gt;
   &lt;/dbagg3:author&gt;
"""

map = (
    ('userName',  'a:name'),
    ('userEmail', 'a:email'),
    ('fooPref',   "dbagg3:prefs/dbagg3:pref[@name='foo']")
)

xd = XPathDict(xml=xml)
xd.cd("/dbagg3:user")
print xd.extract(map)

#    {'userName'  : 'deusx', 
#     'userEmail' : 'deus_x@pobox.com', 
#     'fooPref'   : 'bar'}
</code></pre>
<p>There isn't any spectacular code behind all this, and the idea <em>was</em> Kimbro's, but it's working.  It's also incredibly convenient, especially with the little XML-to-dict extraction map method I whipped up.  This would take a bit more work to pry it out of its current context, such as turning the hardcoded namespaces into an option, among other things.  But, <a href="http://www.decafbad.com/cvs/*checkout*/dbagg3/lib/dbagg3/xmlutils.py">here's the code</a> for you to peruse.</p>
<p>(I got hooked early on subverting in-built language constructs from perl's <code>tie</code> facilities, and C++'s operator overloading.  Now I'm loving Python's <a href="http://diveintopython.org/object_oriented_framework/special_class_methods2.html">special class methods</a>.  Someday, maybe, I'll actually get down to doing some work in LISP and wrap my head around some <em>real</em> language subversion.)</p>
<p>Anyway, while this is neither quite <a href="http://dev2dev.bea.com/products/wlworkshop/articles/JSchneider_XML.jsp">Native XML Scripting</a> nor XML as <a href="http://www.xmldatabases.org/WK/blog/663?t=item">a native language construct</a>, it's getting there.</p>
<div id="comments" class="comments archived-comments"><h3>Archived Comments</h3>
<ul class="comments">
<li class="comment" id="comment-221090556">
<div class="meta">
<div class="author">
<a class="avatar image" rel="nofollow" href="http://naeblis.cx"><img src="http://www.gravatar.com/avatar.php?gravatar_id=abfc88b96ae18c85ba7aac3bded2ec5e&amp;size=32&amp;default=http://mediacdn.disqus.com/1320279820/images/noavatar32.png" width="" height=""></a>
<a class="avatar name" rel="nofollow" href="http://naeblis.cx">Ryan Tomayko</a>
</div>


<p><a href="#comment-221090556" class="permalink"><time datetime="2004-09-01T17:29:27">2004-09-01T17:29:27</time></a></p>
</div>


<div class="content">Funny that. I also have one that has survived a couple of failed apps. I have a hard time dropping it to be honest and just keep lugging it around to each new project. 
http://naeblis.cx/cvs/percolator/xb/lib/xpdm.py?rev=HEAD&amp;content-type=text/vnd.viewcvs-markup
It has some pretty big issues. Among other things, creating nodes with namespace support is a little.. ermmm.. not there. But it does a lot of things well like garbage collecting xmlDoc instances (freeDoc), copying nodesets between documents, encoding things when they need to be, etc.
Anyway, I wonder if maybe we all might benefit by teaming up on this and try to define what a complete xpathish wrapper atop libxml2 should look like. And really, why limit it to libxml2? I'm of the opinion that the value here is an interface that embraces xpath. The fact that it's running on top of the blazingly fast libxml2 is nice but coding against the XMLTRAMP like interface is the value for me.
So let me see if I can get some time together to whip up a quick comparison of the three implementations. I'll shoot that over to you and Kimbro and we can go from there. If these seem to work best as backyard APIs we like to keep close to us, we'll drop it. However, I think there's a good chance that we can all benefit by combining our efforts.</div>


</li>
</ul>


</div>

        
      </article>

      <section class="posts-nav content-grid">
        <span class="prev-post">
            <span
              ><a href="/blog.lmorchard.com/2004/09/12/moving-time-again/"
                >Moving time again</a
              ></span
            >
            <span
              ><span class="fa fa-long-arrow-left"></span>&nbsp;Previous</span
            >
          </span>
        <span class="next-post">
            <span
              ><a href="/blog.lmorchard.com/2004/08/30/dbagg3-makingprogress/"
                >Making progress on dbagg3</a
              ></span
            >
            <span>Next&nbsp;<span class="fa fa-long-arrow-right"></span></span>
          </span>
      </section></section>

        <footer class="content-grid">
          <div class="left">
            © 2024 Les Orchard &lt;<a href="mailto:me@lmorchard.com"
              >me@lmorchard.com</a
            >&gt;
          </div>
          <img id="growup" src="/blog.lmorchard.com/uploads/growup.jpg" />
          <nav class="right">
            <ul>
              <li>
                <a href="https://lmorchard.github.io/blog.lmorchard.com/index.rss" title="blog.lmorchard.com"
                  ><span class="fa fa-rss"></span> feed</a
                >
              </li>
            </ul>
          </nav>
        </footer>
      </body>
    </html>